---
title: "may-4-draft"
name: "Olivia Borgula"
date: 05/04/2024
format: html
editor: visual
---

**INTRODUCTION** This data analysis project will examine how incarceration, wealth and race intersect and play a role in voter registration in Baltimore City â€” an especially newsworthy topic ahead of elections season this November. Specifically, I will ask these five questions to guide my findings:

1.  Which five zip code-determined areas in Baltimore had the least amount of registered voters in August 2020? Which five zip code-determined areas in Baltimore had the most?

2.  What was the rate of incarceration per 100,000 in the top five zip-code defined areas in Baltimore City with the lowest voter turnout? What about in the top five areas with the highest voter turnout?

3.  How many people registered to vote in the August 2020 in the top 10 areas in Baltimore City with the highest median household income? What about in the 10 lowest areas?

4.  Which race in Baltimore had the least amount of registered voters in August 2020 as a share of their voting precinct population numbers?

5.  How has voter registration changed in the past four years?

**THE DATA** The core datasets I will use (not including new datasets I create through joins) include:

1.  demo_voting_x2020_politics - voter demographic information by voting precinct in 2020 in Baltimore City via the Maryland Department of Planning. Contains the number of people in each precinct by race. https://planning.maryland.gov/Redistricting/Documents/2020data/GreenReport.pdf

2.  incarceration_x2020 - a data table scraped from a Prison Policy Initiative website with information about the incarceration rate in different Baltimore zip codes in 2020. https://www.prisonpolicy.org/origin/md/2020/zipcode.html

3.  x2020_precinct_voters - voter registration counts in 2020 by voting precinct in Baltimore City via the city's voting information page. https://boe.baltimorecity.gov/registration-figures

4.  precinct_addresses_x2020 - table with information about precinct numbers, zip codes and addresses. I imputting this website from 2024 into the wayback machine to get 2020 datasets. https://boe.baltimorecity.gov/boe-polling-locations

5.  zip_csa - table with Baltimore City's community statistical areas, or CSAs and zip codes. https://bniajfi.org/mapping-resources/

6.  baltcity_income - data given in labs about median household income in Baltimore City CSAs from different years, including 2020.

7.  x20204_precinct_voters - voter registration counts in 2024 by voting precinct in Baltimore City via the city's voting information page. https://boe.baltimorecity.gov/registration-figures

**SET UP**

```{r}
#libraries and settings
library(tidyverse)
library(janitor)
library(formattable)
library(dplyr)
library(rvest)
library(sf)

#turn off scientific notation
options(scipen=999)
```

**UPLOAD/CLEAN DATA**

demo_voting_x2020_politics
uploading data and cleaning so I'm just left with columns I need

```{r}
#voting by demographic 2020
demo_voting_x2020_politics <- read_csv("data/demo_voting_x2020_finalll.csv", locale=locale(encoding="latin1"))%>%
  clean_names
#delete top seven rows for worcester copied from the page before and column three filled with only N/As
demo_voting_x2020_politics <- demo_voting_x2020_politics[-c(1:7), -3]%>%
  slice(-1)%>%
  rename(precinct = voting_district_vtd, precinct_pop = total_population)%>%
  select(precinct, precinct_pop)
```

x2020_precinct_voters 

```{r}
#upload csv 
x2020_precinct_voters <- read_csv("data/cleaned_precinct_x2020.csv")

#remove rows with NAs and get rid of extra column copied from PDF
x2020_precinct_voters <- x2020_precinct_voters %>%
  filter(complete.cases(.))%>%
  slice(-111) 

#make a new datast with most important info 
x2020_precinct_voters_clean <- x2020_precinct_voters%>%
  rename(total_reg = total)%>%
  select(precinct, total_reg)
```

precinct_addresses

```{r}
#table with information about precinct numbers, zip codes and addresses
precinct_addresses_x2020 <- read_csv("data/zip_precinct_x2020_cleaned.csv")%>%
  clean_names()
precinct_addresses_x2020 <- precinct_addresses_x2020%>%
  rename(precinct = ward_and_precincts)
```

join to voter reg/precinct pop datasets
```{r}
#join csa_precinct with x2020_precinct_voters_clean
first_join <- inner_join(csa_precinct, x2020_precinct_voters_clean, by = "precinct")

#join the resulting data frame with demo_voting_x2020_politics
csa_reg <- inner_join(first_join, demo_voting_x2020_politics, by = "precinct")

```

incarceration_x2020

```{r}
#webscrape data table from prison policy initiative website 
incarceration_x2020 <- "https://www.prisonpolicy.org/origin/md/2020/baltimore_csa.html"
incarceration_x2020 <- incarceration_x2020 %>% 
  read_html() %>% 
  html_table()
incarceration_x2020 <- incarceration_x2020[[1]]%>%
  clean_names()%>%
  rename(csa = 1, num_prison = 2, census_pop = 3, total_pop = 4, rate_per_x100000 = 5)
```

baltcity_income

```{r}
#income in baltimore city
baltcity_income <- read_csv("data/baltcity_income.csv")%>%
  clean_names()

baltcity_income <- baltcity_income%>%
  rename(csa = neighborhood)
```

**Q1: Which Baltimore City community statistical areas had the least amount of registered voters in August 2020? Which five had the most?**

```{r}
pct_voted <- read_csv("data/pct_vote_csa_clean.csv")
```

Every Baltimore City voter is registered at one of 296 precincts, or voting places with specific addresses. Each precinct is within a CSA, with most CSAs containing multiple precincts. The precincts are points while CSAs are polygons. 

This is the best way to compare data because stating "precinct 12-001 had the lowest voter registration" doesn't mean anything to readers. CSAs are useful because other ways to represent data, such as zip codes extend beyond the city limits, with some zip codes half inside Baltimore City and half outside. It's also the most efficient way to compare to other data, such as median household income and incarceration rates. 

I'll use a spatial join to assign each precinct to a CSA. I uploaded my precinct_addresses_x2020 csv to geocodeio, which gave me a new csv with each address' lat/long coordinates, and got a geojson file for the CSA boundaries from Open Baltimore. https://data.baltimorecity.gov/datasets/9c96ae20e6cc41258015c2fd288716c4/explore

I verified the accuracy of the resulting dataset by imputting the precinct addresses in this interactive website that shows CSA boundaries. https://bniajfi.org/vital_signs/

```{r}
#upload precincts with addresses and lat/long coords
precincts <- read.csv("data/precinct_geocode.csv")%>%
  clean_names

#upload geojson
csas <- st_read("data/Community_Statistical_Areas_(CSAs)__Reference_Boundaries.geojson")

#convert precinct data to spatial object
precincts_sf <- st_as_sf(precincts, coords = c("longitude", "latitude"), crs = 4326)

csa_precinct <- st_join(precincts_sf, csas, join = st_within)%>%
  select(ward_and_precincts, Community)

csa_precinct <- csa_precinct%>%
  rename(precinct = ward_and_precincts, csa = Community)
```

Join datasets for voter registration, precinct population and csa
```{r}
#join csa_precinct with x2020_precinct_voters_clean
first_join <- inner_join(csa_precinct, x2020_precinct_voters_clean, by = "precinct")

#join the resulting data frame with demo_voting_x2020_politics
csa_reg <- inner_join(first_join, demo_voting_x2020_politics, by = "precinct")
```

The next step is to find the average number of registered voters in each CSA. Because there are multiple voting precincts in each CSA, I will first find the percent of registered voters in each precinct, and then group by CSA and find the average 
```{r}
csa_stats <- csa_reg %>%
  group_by(csa) %>%
  summarise(
    total_population = sum(precinct_pop),
    total_registered_voters = sum(total_reg)
  )

# Calculate the percentage of registered voters for each CSA
csa_stats <- csa_stats %>%
  mutate(registered_voter_percent = (total_registered_voters / total_population) * 100)
```

**Q2: What was the rate of incarceration per 100,000 in the top five Baltimore City community statistical areas with the lowest voter turnout? What about in the top five areas with the highest voter turnout? Is there a correlation between the two?**

```{r}
#Get scraped datatable into csv format to upload to flourish
write.csv(incarceration_x2020, "flourish_incarceration.csv", row.names = FALSE)
```


```{r, results='asis'}
cat('<div class="flourish-embed flourish-map" data-src="visualisation/17809409"><script src="https://public.flourish.studio/resources/embed.js"></script></div>')
```

**Q3: What was the average voter registration percentage August 2020 among voting precincts the top five Baltimore City community statistical areas with the highest median household income? What about in the five lowest areas?**

```{r}
#join csa_precinct with balt_income 
income_voting <- inner_join(csa_precinct, baltcity_income, by = "csa")

#slice max/min
```

Visualize this with a scatterplot to show the relationship between income and voter registration

```{r, results='asis'}
cat('')
```

**Q4: What percent of registered voters were democrats in 2020? What about Republican? And how does this differ from registered voters in 2024?**

```{r}

```

